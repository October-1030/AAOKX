# 🔐 真实交易安全配置指南

**⚠️ 请仔细阅读！真实交易涉及真实资金，配置错误可能导致资金损失！**

---

## 📋 前置检查清单

在启动真实交易前，请确认：

- [ ] ✅ 你已经**完全理解** Hyperliquid 永续合约交易的风险
- [ ] ✅ 你已经在 Hyperliquid **测试网**进行过充分测试
- [ ] ✅ 你愿意承担 AI 自动交易可能导致的**全部损失**
- [ ] ✅ 你已经设置了**合理的资金上限**（建议 ≤ $100 开始）
- [ ] ✅ 你已经**撤销了之前暴露的 API 密钥**

---

## 🚨 第一步：撤销暴露的 API 密钥（立即执行！）

### 1.1 访问 Hyperliquid API 管理页面

```
https://app.hyperliquid.xyz/API
```

### 1.2 撤销旧密钥

1. 连接你的 MetaMask 钱包 (`0x99c11e5AF3d953E299Abf5Ae55c40579327027aF`)
2. 找到 API 钱包地址：`0xa42ca24c9fB4574306399Ec8d28c16522cD0B1F0`
3. 点击 **"Revoke"** 或 **"Delete"** 按钮
4. 确认交易（可能需要支付少量 Gas 费）

### 1.3 检查钱包余额

访问：https://app.hyperliquid.xyz/

确认：
- ✅ 没有未授权的交易
- ✅ 余额正常
- ✅ 没有异常持仓

---

## 🔑 第二步：生成新的 API 密钥

### 2.1 在测试网生成（推荐先测试）

**测试网环境：**
```
https://app.hyperliquid-testnet.xyz/API
```

1. 连接钱包
2. 点击 "Create API Key"
3. 设置权限：
   - ✅ **Trading** (交易权限)
   - ❌ **Withdraw** (不要开启提款权限！)
4. 保存生成的密钥：
   - **API Wallet Address**: `0x...` (新地址)
   - **API Secret Key**: `0x...` (私钥，只显示一次！)

⚠️ **重要提示**：
- 私钥只会显示一次，请立即保存到安全的地方
- **永远不要**在代码中硬编码私钥
- **永远不要**提交包含私钥的文件到 Git

### 2.2 主网生成（测试成功后）

如果测试网测试成功，重复上述步骤在主网生成：
```
https://app.hyperliquid.xyz/API
```

---

## ⚙️ 第三步：安全配置环境变量

### 3.1 编辑 `.env.local` 文件

**❌ 错误示范（不要这样做）：**
```env
# 不要直接写明文密钥！
HYPERLIQUID_API_SECRET=0xacabfe727eaf4ba13801e89f6f9366ed7f180b898c6dac131c8db0953048ba8f
```

**✅ 正确做法：**

```env
# ==================================================
# Hyperliquid DEX API（真实交易）
# ==================================================

# 主钱包地址（MetaMask 地址）
HYPERLIQUID_MAIN_WALLET=YOUR_MAIN_WALLET_ADDRESS

# API 钱包地址（从 app.hyperliquid.xyz/API 生成的）
HYPERLIQUID_API_WALLET=YOUR_API_WALLET_ADDRESS

# API Secret Key（私钥，保密！绝对不要泄露！）
HYPERLIQUID_API_SECRET=YOUR_API_SECRET_KEY

# 是否使用测试网（true = 测试网，false = 主网）
# ⚠️ 第一次运行必须使用测试网！
HYPERLIQUID_TESTNET=true
```

### 3.2 确保 `.env.local` 在 `.gitignore` 中

检查 `.gitignore` 文件包含：
```
.env.local
.env*.local
```

---

## 🧪 第四步：测试网测试（必须！）

### 4.1 配置测试网模式

在 `.env.local` 中设置：
```env
HYPERLIQUID_TESTNET=true
```

### 4.2 获取测试网资金

1. 访问 Hyperliquid 测试网 Discord
2. 申请测试网 USDC（免费）
3. 确认测试网钱包有余额

### 4.3 运行测试

启动项目：
```bash
npm run dev
```

观察日志：
```
[Hyperliquid] 🚀 初始化客户端...
[Hyperliquid] ✅ 客户端初始化成功
[Hyperliquid] 📍 模式: Testnet  <-- 确认是测试网
[Hyperliquid] 👛 API 钱包: 0x...
[Hyperliquid] 💰 账户余额: $XXX.XX
```

### 4.4 手动执行一次交易

点击 "Execute Cycle" 按钮，观察：
1. 是否成功连接到 Hyperliquid API
2. 是否正确获取市场价格
3. AI 是否做出交易决策
4. 订单是否成功提交（在测试网）

### 4.5 验证订单

访问测试网查看订单历史：
```
https://app.hyperliquid-testnet.xyz/
```

确认：
- ✅ 订单已提交
- ✅ 订单已成交
- ✅ 持仓正确显示
- ✅ P&L 计算正确

---

## 🚀 第五步：主网真实交易（谨慎！）

### 5.1 最终检查

在启用主网前，再次确认：

- [ ] ✅ 测试网测试已通过
- [ ] ✅ AI 交易逻辑符合预期
- [ ] ✅ 风险控制参数已设置
- [ ] ✅ 交易资金量在可承受范围内
- [ ] ✅ 已理解可能的最大损失

### 5.2 配置主网模式

**步骤 1：更新 `.env.local`**
```env
# 切换到主网
HYPERLIQUID_TESTNET=false

# 使用主网 API 密钥（不是测试网的！）
HYPERLIQUID_MAIN_WALLET=YOUR_MAINNET_WALLET
HYPERLIQUID_API_WALLET=YOUR_MAINNET_API_WALLET
HYPERLIQUID_API_SECRET=YOUR_MAINNET_API_SECRET
```

**步骤 2：设置交易限制**

编辑 `lib/tradingConfig.ts`，设置合理的限制：
```typescript
// 建议配置
maxPositionSize: 50,      // 单笔最大 $50
maxLeverage: 5,           // 最大 5x 杠杆（不要太高！）
maxDailyTrades: 10,       // 每日最大 10 笔交易
maxTotalExposure: 100,    // 总敞口 $100
```

**步骤 3：启用真实交易**

编辑 `lib/config.ts`：
```typescript
USE_REAL_TRADING: true, // ✅ 启用真实交易
```

**步骤 4：重启项目**
```bash
# 停止现有进程（Ctrl+C）
npm run dev
```

观察启动日志：
```
Alpha Arena Configuration:
- Market Data: 🌐 Real (CoinGecko)
- AI Models: 🤖 Real (DeepSeek)
- Trading Mode: ⚠️ LIVE TRADING (Hyperliquid)  <-- 确认是真实交易
```

### 5.3 监控第一笔交易

**非常重要：** 第一次运行时，坐在电脑前**全程监控**！

1. 点击 "Execute Cycle" 执行一次交易
2. 观察浏览器控制台（F12）
3. 观察命令行日志
4. 立即在 Hyperliquid 上查看订单：
   ```
   https://app.hyperliquid.xyz/
   ```

如果一切正常：
- ✅ 订单已提交且成交
- ✅ P&L 计算正确
- ✅ 持仓符合预期

如果有任何异常：
- ❌ 立即停止项目（Ctrl+C）
- ❌ 手动平仓（在 Hyperliquid 网页上）
- ❌ 设置 `USE_REAL_TRADING: false`

---

## 🛡️ 风险控制建议

### 1. 资金管理

```typescript
// 推荐配置（保守）
初始资金: $100 - $500
单笔交易: $20 - $50
最大杠杆: 3x - 5x
止损: -5% 自动平仓
```

### 2. 监控措施

- ✅ 设置手机提醒（Discord/Telegram）
- ✅ 每小时检查一次持仓
- ✅ 使用 Hyperliquid 原生止损单
- ✅ 设置每日最大亏损限制

### 3. 紧急停止

如果发生意外，立即：
1. 按 `Ctrl+C` 停止项目
2. 访问 https://app.hyperliquid.xyz/
3. 点击 "Close All Positions"
4. 撤销 API 密钥

---

## 📊 验证系统是否真的在交易

### 实时日志

观察命令行输出：
```bash
[RealTrading] 🚀 初始化真实交易执行器
[RealTrading] 模式: 真实交易  <-- 确认模式
[RealTrading] 💰 DeepSeek V3.1 - 执行真实交易决策
[RealTrading] 动作: BUY
[RealTrading] 📝 开仓 LONG: { coin: 'BTC', size: 30, leverage: 10 }
[Hyperliquid] ✅ 订单已提交: { ... }
```

### 浏览器控制台

按 F12 查看：
```javascript
[RealTrading] ✅ LONG BTC $30.00 @ 10x
Trading cycle completed (Real Trading Mode)
```

### Hyperliquid 界面

访问 https://app.hyperliquid.xyz/ 查看：
- 📊 Positions（持仓）
- 📜 Order History（订单历史）
- 💰 Account Value（账户价值）

---

## ❓ 常见问题

### Q1: 如何确认真的在用真钱交易？

**A:** 检查三个地方：
1. 命令行显示 `模式: 真实交易`
2. 浏览器控制台显示 `Real Trading Mode`
3. Hyperliquid 网页上能看到新订单

### Q2: AI 一直不交易怎么办？

**A:** 这是正常的！AI 模型有自己的决策逻辑：
- Claude: 极度保守，很少交易
- DeepSeek: 50% 概率交易
- Gemini: 80% 概率交易

如果想要更频繁交易，修改 `lib/aiModels.ts` 中的交易概率。

### Q3: 如何设置止损止盈？

**A:** 在 AI 决策中已经包含：
```typescript
exitPlan: {
  stopLoss: 64500,     // 止损价
  takeProfit: 72000,   // 止盈价
}
```

系统会自动监控并执行止损/止盈。

### Q4: 手续费多少？

**A:** Hyperliquid 手续费：
- Maker: -0.02% (返佣)
- Taker: 0.055%

市价单通常是 Taker，每笔约 0.055%。

### Q5: 如何完全停止交易？

**A:** 三步：
1. 停止项目（Ctrl+C）
2. 设置 `USE_REAL_TRADING: false`
3. 手动平仓（如果有持仓）

---

## 🔒 安全最佳实践

### ✅ 应该做的事

1. **使用测试网测试** - 先在测试网验证所有功能
2. **小资金开始** - 第一次用 $50-$100
3. **设置低杠杆** - 不要超过 5x
4. **监控持仓** - 每小时检查一次
5. **备份私钥** - 用密码管理器保存
6. **设置止损** - 每笔交易都要有止损

### ❌ 不应该做的事

1. **不要分享私钥** - 包括在聊天、截图、代码中
2. **不要高杠杆** - 超过 10x 非常危险
3. **不要大资金** - 不要投入超过承受范围的资金
4. **不要无监控** - 不要启动后就不管了
5. **不要跳过测试** - 必须在测试网先测试
6. **不要提交密钥** - 确保 .env.local 在 .gitignore 中

---

## 🆘 紧急联系方式

如果遇到问题：

1. **Hyperliquid Discord**: https://discord.gg/hyperliquid
2. **Hyperliquid 文档**: https://hyperliquid.gitbook.io/
3. **紧急平仓**: https://app.hyperliquid.xyz/ → "Close All"

---

## 📝 免责声明

**本系统仅供教育和研究用途。**

- ⚠️ 加密货币交易具有极高风险
- ⚠️ AI 自动交易可能导致资金全部损失
- ⚠️ 使用者需自行承担所有风险和损失
- ⚠️ 开发者不对任何交易结果负责

**请只用你愿意失去的资金进行测试！**

---

## ✅ 配置完成检查清单

在启动真实交易前，再次确认：

- [ ] 已撤销暴露的旧 API 密钥
- [ ] 已生成新的 API 密钥（带交易权限，不带提款权限）
- [ ] 已在测试网成功测试
- [ ] 已设置合理的交易限制
- [ ] 已理解并接受所有风险
- [ ] 准备好全程监控第一笔交易
- [ ] 知道如何紧急停止和平仓

如果所有项都打勾了，你可以开始真实交易了。**祝好运！🚀**
